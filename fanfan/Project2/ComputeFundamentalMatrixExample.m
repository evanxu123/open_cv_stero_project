
%matchedPoints1=[1429.66090819349,1556.53158933860;823.666831194472,1419.21273445212;419,2153;1149.52702702703,2389.87837837838;1523.56341463415,1073.65121951220;1854.66189536032,939.044916090819;1489.26110562685,1443.52764067127;1825.96341463415,1287.54390243902;519.864264560711,1749.10612043435;325.708292201382,1925.20286278381;2060.99950641658,2105.80700888450;289.317374136229,702.766535044422;460.862290227048,453.877097729516;719.185093780849,593.807008884501;2268.50000000000,1538.31463414634;2967.39437314906,2148.74777887463;913.222606120434,698.288746298123];
matchedPoints1=[1415.00000000000,1583.00000000000;1343.00000000000,1957.00000000000;1014.00000000000,1395;958.000000000000,1736.00000000000;2481,1743.00000000000;2069.00000000000,1283.00000000000;1421.00000000000,595.000000000000;1643.00000000000,621.000000000000;2515,2387;525,869.999999999999;677.000000000000,2032;1645.00000000000,2143;2285,1105.00000000000;1835.00000000000,1198.00000000000;321,1526;1537.00000000000,2546;125,767.000000000000]
matchedPoints2=[1589,1502.00000000000;1490.00000000000,1872.00000000000;1283.00000000000,1261.00000000000;1199.00000000000,1590.00000000000;2797,1839.00000000000;2480,1276.00000000000;2074,484.000000000000;2314,531;2447,2549;1023.00000000000,690.000000000000;847.000000000000,1840.00000000000;1612,2115;2752,1110.00000000000;2206,1153.00000000000;705.000000000000,1304.00000000000;1433.00000000000,2506;769.000000000000,563]
%matchedPoints2=[1417,1576;1016.00000000000,1397.00000000000;536.000000000000,1949.00000000000;947.000000000000,2261;1838.00000000000,1195.00000000000;2282,1104.00000000000;1797.00000000000,1538;2245,1443;815.000000000000,1659;584,1764.00000000000;1642,2140;1010.00000000000,786.000000000000;1422,596.000000000000;1656,736.000000000000;2482,1747;2519,2384;1715.00000000000,834.000000000000];
[fLMedS,inliers] = estimateFundamentalMatrix(matchedPoints1,...
    matchedPoints2,'NumTrials',4000);

I1 = imread('img/2.jpg');
figure; 
subplot(121);
imshow(I1); 
title('Inliers and Epipolar Lines in First Image'); hold on;
plot(matchedPoints1(inliers,1),matchedPoints1(inliers,2),'yo',matchedPoints1(~inliers,1),matchedPoints1(~inliers,2),'wo')
%plot(cpstruct.inputPoints(inliers,1),cpstruct.inputPoints(inliers,2),'yo',cpstruct.inputPoints(~inliers,1),cpstruct.inputPoints(~inliers,2),'wo')


epiLines = epipolarLine(fLMedS',matchedPoints2(inliers,:));

points = lineToBorderPoints(epiLines,size(I1));
line(points(:,[1,3])',points(:,[2,4])'); 


I2 = imread('img/3.JPG');
subplot(122); 
imshow(I2);
title('Inliers and Epipolar Lines in Second Image'); hold on;
plot(matchedPoints2(inliers,1),matchedPoints2(inliers,2),'yo',matchedPoints2(~inliers,1),matchedPoints2(~inliers,2),'wo')

epiLines = epipolarLine(fLMedS,matchedPoints1(inliers,:));
points = lineToBorderPoints(epiLines,size(I2));
line(points(:,[1,3])',points(:,[2,4])');
truesize;